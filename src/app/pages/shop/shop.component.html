<div class="glass-panel shop-container fade-in">

  <button class="close-btn-round" (click)="onClose()">
    <span>‚úï</span>
  </button>

  @switch (viewMode()) {

  <!-- Market View -->
  @case ('market') {
  <div class="shop-view">
    <div class="shop-header">
      <h3 class="shop-title">{{ getText('marketTitle') }}</h3>
      <div class="shop-wallet">üí∞ {{ money() }}</div>
    </div>

    <p class="shop-prompt">{{ getText('marketPrompt') }}</p>

    <div class="button-stack">
      <button (click)="openBuy()" class="shop-action-btn primary">
        <span class="btn-icon">üõí</span>
        <span class="btn-label">{{ getText('buy') }}</span>
      </button>
      <button (click)="openSell()" class="shop-action-btn secondary">
        <span class="btn-icon">üì¶</span>
        <span class="btn-label">{{ getText('sell') }}</span>
      </button>
    </div>
  </div>
  }

  <!-- Buy View -->
  @case ('buy') {
  <div class="shop-view full-height">
    <div class="shop-header">
      <h3 class="shop-title">{{ getText('buyTitle') }}</h3>
      <button (click)="openMarket()" class="back-link">‚Üê {{ getText('back') }}</button>
    </div>

    <div class="items-grid">
      @for (itemId of availableShopItems(); track itemId) {
      <div class="shop-item-card">
        <div class="item-visual">
          <img [src]="getItemData(itemId).path" [alt]="getItemName(itemId)" class="item-img">
        </div>

        <div class="item-info">
          <p class="item-name">{{ getItemName(itemId) }}</p>
          <p class="item-price">üí∞ {{ getItemData(itemId).buyPrice }}</p>
        </div>

        <button (click)="buyItem(itemId)" class="buy-btn" [disabled]="money() < (getItemData(itemId).buyPrice || 0)">
          {{ getText('buy') }}
        </button>
      </div>
      }
    </div>
  </div>
  }

  <!-- Sell View -->
  @case ('sell') {
  <div class="shop-view full-height">
    <div class="shop-header">
      <h3 class="shop-title">{{ getText('sellTitle') }}</h3>
      <button (click)="openMarket()" class="back-link">‚Üê {{ getText('back') }}</button>
    </div>

    <div class="items-grid">
      @for (item of sellableInventoryItems(); track item.id) {
      <div class="shop-item-card sell-card">
        <div class="item-visual">
          <img [src]="getItemData(item.id).path" [alt]="getItemName(item.id)" class="item-img">
          <span class="qty-badge">x{{ item.quantity }}</span>
        </div>

        <div class="item-info">
          <p class="item-name">{{ getItemName(item.id) }}</p>
          <p class="item-price profit">üí∞ {{ getItemData(item.id).sellPrice }}</p>
        </div>

        <button (click)="openSellConfirmation(item.id)" class="sell-btn">
          {{ getText('sell') }}
        </button>
      </div>
      } @empty {
      <div class="empty-msg">{{ getText('noItemsToSell') }}</div>
      }
    </div>
  </div>
  }

  <!-- Sell Confirmation View -->
  @case ('sell-confirm') {
  <div class="shop-view centered-content">
    @if (selectedItemToSell(); as selection) {
    <h3 class="confirm-title">{{ getText('sellConfirmTitle') }}</h3>

    <div class="confirm-item-preview">
      <img [src]="getItemData(selection.item.id).path" class="preview-img">
      <p class="preview-name">{{ getItemName(selection.item.id) }}</p>
    </div>

    <p class="confirm-prompt">{{ getText('sellConfirmPrompt') }}</p>

    <div class="qty-selector">
      <button class="qty-adjust" (click)="sellQuantityInput.set(Math.max(1, sellQuantityInput() - 1))">-</button>
      <input type="number" [ngModel]="sellQuantityInput()" (ngModelChange)="sellQuantityInput.set($event)"
        class="qty-input" min="1" [max]="maxSellQuantity()">
      <button class="qty-adjust"
        (click)="sellQuantityInput.set(Math.min(maxSellQuantity(), sellQuantityInput() + 1))">+</button>
    </div>

    <div class="button-stack">
      <button (click)="confirmSell()" class="shop-action-btn primary confirm">
        {{ getText('confirmSell') }} (üí∞ {{ (selection.item.sellPrice || 0) * sellQuantityInput() }})
      </button>
      <button (click)="openSell()" class="shop-action-btn secondary">{{ getText('cancel') }}</button>
    </div>
    }
  </div>
  }
  }
</div>